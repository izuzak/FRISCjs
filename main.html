<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="FRISCjs - FRISC processor simulator in JavaScript" />
    <meta name="author" content="Ivan Zuzak" />
    
    <title> FRISCjs - FRISC processor simulator in JavaScript</title>
    
    <link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" />
    <link rel="stylesheet" href="ace-mode-frisc.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="friscasm.js"></script>
    <script type="text/javascript" src="friscjs.js"></script>
    <script type="text/javascript" src="https://raw.github.com/ajaxorg/ace/master/build/src/ace.js"></script>
    <script type="text/javascript" src="http://twitter.github.com/bootstrap/assets/js/bootstrap-tab.js"></script>
    <script type="text/javascript" src="http://twitter.github.com/bootstrap/assets/js/bootstrap-button.js"></script>
    <script type="text/javascript" src="https://raw.github.com/madrobby/keymaster/master/keymaster.js"></script>
    <script type="text/javascript" src="ace-mode-frisc.js"></script>
  </head>
  <body>
    <div class="container" style="width: 1140px">
      <h1> FRISCjs <small> FRISC processor simulator in JavaScript </small> </h1>
      <ul class="nav nav-tabs">
        <li class="active"><a href="#frisc-sim" data-toggle="tab">Simulator</a></li>
        <li><a href="#frisc-usage" data-toggle="tab">Usage instructions</a></li>
        <li><a href="#frisc-about" data-toggle="tab">About</a></li>
      </ul>
      <div class="tab-content" style="margin-bottom: 20px;">
        <div id="frisc-usage" class="container tab-pane" style="width: auto;">
          <div class="well">
            <h3> Usage instructions </h3>
            <ol>
              <li> Enter your FRISC assembler program into the textbox on the left. Note: the simulator has a memory module of 256KB, i.e. from 0x00000000 to 0x0003FFFF.</li>
              <li> Press the <b>"Load"</b> button to parse the program and load it into memory. In case of parsing errors, the error message, line and column numbers will be logged to the output screen.</li>
              <li> Press the <b>"Run all"</b> button to start the CPU.</li>
              <li> Enter the instructions-per-second frequency and press <b>"Set CPU freq!"</b> to change the CPU speed.</li>
              <li> Press the <b>"Pause"</b> button to pause CPU execution.</li>
              <li> Press the <b>"Run one"</b> button to force the CPU to execute the next instruction.</li>
              <li> Press the <b>"Stop"</b> button to stop the CPU completely and return to defining the program.  </li>
              <li> Press the <b>"Clear"</b> button to clear the log output screen. </li>
              <li> To view the state of a part of memory, enter the lower and upper bound into the textboxes and press <b>"Show memory state"</b>. Choose <b>"HEX"</b> or <b>"DEC"</b> to define whether the defined bounds and displayed addresses are hexadecimal or decimal numbers.</p>
              </li>
            </ol>
            <p>
              More information about FRISC is available <a href="http://www.fer.unizg.hr/_download/repository/knjiga_FRISC_izvadak.pdf">here</a> (in Croatian), while a cheat sheet for the FRISC instruction set and IO units is available <a href="http://www.fer.unizg.hr/_download/repository/salabahter_cijeli.pdf">here</a> (in Croatian).
            </p>
          </div>
        </div>
        <div id="frisc-about" class="container tab-pane" style="margin-bottom: 20px; width: auto;">
          <div class="well">
            <h3> About </h3>
            <p>
              FRISCjs is a simulator of the FRISC processor written in JavaScript.
              <a href="http://www.fer.unizg.hr/rasip/knjige/frisc">FRISC</a> is a simple, educational RISC processor developed at the <a href="http://fer.unizg.hr/en">University of Zagreb, Faculty of Electrical Engineering and Computing</a>.
              The simulator has two parts: a <a href="https://github.com/izuzak/FRISCjs/blob/master/friscasm.pegjs">FRISC assembler</a> (built using PEGjs) which translates FRISC assembly code to machine code and a <a href="https://github.com/izuzak/FRISCjs/blob/master/friscjs.js">FRISC CPU simulator</a> which executes machine code.
              This Web application is a graphical interface for the simulator, while there also exists a <a href="https://github.com/izuzak/FRISCjs/blob/master/main.js">console interface which runs on NodeJS</a>.
            </p>

            <h3> Source code and bug reports </h3>
              <p>
                The complete source code for FRISCjs and this Web application is <a href="https://github.com/izuzak/FRISCjs">available on GitHub</a>.
                Please use the GitHub <a href="https://github.com/izuzak/FRISCjs/issues">issue tracker</a> for reporting bugs and feature requests.
              </p>
            <h3> Credits and license </h3>
              <p>
                FRISCjs was developed by <a href="http://ivanzuzak.info">Ivan Zuzak</a>. License: <a href="https://github.com/izuzak/FRISCjs/blob/master/LICENSE.markdown">Apache 2.0.</a> Contributors: <a href="https://github.com/ibudiselic">Ivan Budiselic</a>, <a href="https://github.com/Stankec">Stanko Krtalic</a>.
              </p>
              <p>
                FRISCjs is built with many open-source projects: <a href="http://pegjs.majda.cz/">PEGjs</a>, <a href="http://nodejs.org">NodeJS</a>, <a href="http://jquery.com">jQuery</a>, <a href="http://twitter.github.com/bootstrap">Bootstrap</a>, <a href="http://ace.ajax.org/">Ace</a> and <a href="https://github.com/madrobby/keymaster">Keymaster</a>.
              </p>
          </div>
        </div>
        <div id="frisc-sim" class="active container-fluid tab-pane" style="padding-left: 0px;">
          <div id="frisc-inputdiv" class="sidebar" style="width: 450px; height: 500px;">
          </div>

          <div class="sidebar ace_editor ace-tm" id="frisc-memorylist-hold" style="width: 450px; height: 495px; display:none;">
            <div style="width: 448px; height: 30px; display:inline-block;  position:absolute; top:0px; border: 1px solid #dddddd; border-collapse: separate; border-radius: 4px 4px 0px 0px; background-color:#f1f1f1; padding-top:5px;">
              <div style='display:inline-block; width:40px;  border-right: 1px solid #000000; padding-left: 4px; vertical-align: middle; padding-top: 1px;'>#</div>
              <div style='display:inline-block; width:185px; border-right: 1px solid #000000; padding-left: 4px; vertical-align: middle; padding-top: 1px;'>Value</div>
              <div style='display:inline-block; width:100px;  padding-left: 4px; vertical-align: middle; padding-top: 1px;'>Command</div>
            </div>

            <div id="frisc-memorylist" style="width: 448px; height: 422px; position:absolute; top:31px; overflow: scroll; overflow-x:hidden; display:inline-block; border: 1px solid #dddddd; border-radius: 0px 0px 4px 4px;">
            </div>

            <div id="frisc-memorylist-search" style="border: 1px solid #dddddd; border-collapse: separate; border-radius: 0px 0px 4px 4px; background-color:#f1f1f1; position:absolute; bottom:0px; width: 448px; height: 35px; padding-top: 6px;">
              <div style="padding-left: 6px;">
                  <input  type="text" class="input-medium search-query" id="skrMemLisSearchField">
                  <button type="submit" class="btn" id="skrMemLisSearch">Go to</button>
                  <div class="btn-group" data-toggle="buttons-radio" style="display:inline-block; vertical-align: middle;">
                        <button class="btn"         id="skrBaseRadioDec">DEC</button>
                        <button class="btn active"  id="skrBaseRadioHex">HEX</button>
                  </div>
              </div>
            </div>
          </div>

          <div class="content" style="margin-left: 460px;">
          <div id="frisc-controls" style="float: left; margin-left: 10px;">
            <div id="frisc-cpu-controls" class="form-inline" style="width: 666px;">
              <button id="frisc-load" type="button" class="btn btn-success"><i class="icon-download-alt icon-white"></i> Load</button>
              <button id="frisc-execute" type="button" class="btn btn-primary"><i class="icon-fast-forward icon-white"></i> Run all</button>
              <button id="frisc-next" type="button" class="btn btn-primary"><i class="icon-step-forward icon-white"></i> Run one</button>
              <button id="frisc-pause" type="button" class="btn btn-primary"><i class="icon-pause icon-white"></i> Pause</button>
              <button id="frisc-stop" type="button" class="btn btn-danger"><i class="icon-stop icon-white"></i> Stop</button>
              <button id="frisc-clear" type="button" class="btn btn-primary"><i class="icon-remove-sign icon-white"></i> Clear log</button>
              <button id="frisc-showhidesettings" type="button" class="btn btn-primary" data-toggle="button"><i class="icon-wrench icon-white"></i> Settings</button>
            </div>
            <div id="frisc-settings" style="display: none; margin-top: 15px;" class="form-inline">
              <label for="frisc-freq" style="margin-bottom: 0px;">CPU frequency (Hz):</label>
              <input id="frisc-freq" type="number" min="1" step="1" class="input-mini" style="margin-bottom: 0px;" value="1000" />
              <label for="frisc-memsize" style="margin-bottom: 0px;">MEM size (KB):</label>
              <input id="frisc-memsize" type="number" min="1" step="1" class="input-mini" style="margin-bottom: 0px;" value="256" />
            </div>
            <div id="cpuout" style="font-size: 10pt; font-family: courier new; background-color: #D4CDCF; width: 650px; overflow: auto; border: 1px solid #666; padding: 8px; margin-top: 15px; color: black;"></div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      key('backspace', function(){ return false; });

      var height = ($("#frisc-inputdiv").innerHeight() - $("#frisc-cpu-controls").innerHeight()) - 40 + "px";
      $("#cpuout").height(height);
      $("#memout").height(height);

      var _state = "stopped";

      // create FRISC
      var simulator = new FRISC();
      simulator.CPU._frequency = parseFloat($("#frisc-freq").val());

      window.onload = function() {
        $(function() { $("li").css("color", "#404040"); });
        editor = ace.edit("frisc-inputdiv");
        var FriscMode = require("ace/mode/frisc").Mode;
        editor.getSession().setMode(new FriscMode());
        document.getElementById('frisc-inputdiv').style.fontSize='10pt';
        document.getElementById('frisc-inputdiv').style.fontFamily='courier new';
        $(".ace_gutter").width("40px");
        editor.renderer.setHScrollBarAlwaysVisible(false);
        editor.getSession().setValue("; aluop\n\
lab1 ADD R1, R2, R3\n\
lab2 ADD r2, 5, r5\n\
 ADD r5, lab1, r2\n\
; cmpop\n\
 CMP R1, R2\n\
lab5 CMP R1, 5\n\
lab6 CMP r4, lab5\n\
; moveop\n\
lab7 MOVE R4, R5\n\
lab8 MOVE R5, SR\n\
lab9 MOVE SR, r5\n\
 MOVE lab5, r4\n\
lab11 MOVE lab6, sr\n\
; uprop\n\
 JP lab2\n\
 JP_N 54\n\
lab12 JP_UGE (r1)\n\
lab13 RETI_M\n\
; memop\n\
lab14 STORE r1, (r2)\n\
 STORE r4, (r3+23)\n\
 STORE r4, (lab14)\n\
lab15 STORE r5, (200)\n\
lab16 POP r3\n\
; asmop\n\
lab17 `ORG 234\n\
 `DW 1,2,3,4,5\n\
 `DW 54\n\
lab18 `EQU 300\n\
lab19 `DS 12\n\
lab21 `BASE H\n\
lab22 DW 54\n\
 DH 34\n\
 DB 12\n\
lab20 `END\n\
lab23 ADD R1, R2, R3\n\
; fds fsd';");
        editor.resize();
        changeState("stopped");
      };

      function simulatorLog(text, marginLeft) {
        if (typeof text !== "string") {
          text = JSON.stringify(text);
        }

        if (typeof marginLeft === "undefined") {
          marginLeft = "0px";
        }
        
        $("#cpuout").append("<div style='margin: 1px; margin-left: " + marginLeft + "; padding: 0px;'>" + text + "</div>");
        $("#cpuout").scrollTop($("#cpuout")[0].scrollHeight);
      }

      function memLog(text) {
        $("#memout").html(text);
      }

      function getBase () {
        if ($("#skrBaseRadioDec").attr('class')=="btn active") return 10;
        return 16;
      }

      function getMemState(lower, upper) {
        var memStateString = ""; 
        var base = getBase();
        
        for (var i=lower; i>=0 && i<simulator.MEM._memory.length && i<upper; i+=4) {
          var decoded = simulator.CPU._decode(simulator.MEM.read(i));
          decoded = decoded ? " - " + instructionToString(decoded) : "";
          memStateString += i.toString(base)+ ": " + simulator.MEM.read(i).toString() + " - " + convertIntToBinary(simulator.MEM.read(i), 32) + decoded + "</br>";
        }

        return memStateString;
      }

      function createMemList(div) {
        var rowHeight = 18;
        var lastDivMessage="Back to top?"
        var ofF = 1.4;

        //Don't edit this
        var maxRows = Math.floor($('#'+div).height()/rowHeight)*ofF;
        maxRows = maxRows ? maxRows : 100;
        if(Math.floor(maxRows/2)*2 == maxRows) maxRows++;

        var base = getBase();
        var decoded = "";
        var bgColor = "#ffffff";
        $("#"+div).html("");
        
        for (var i=0; i>=0 && i<maxRows*4 && i<simulator.MEM._memory.length; i+=4) {
          decoded = simulator.CPU._decode(simulator.MEM.read(i));
          decoded = decoded ? instructionToString(decoded) : "";
          if (decoded == "MOVE r0 r0") decoded="";

          bgColor = (((i/4)%2)==0) ? "#ffffff" : "#f8f8f8";

          $("#"+div).html($("#"+div).html()+"<div style='height:"+rowHeight+"px; width:100%; background-color:"+bgColor+"; position:absolute; top:"+((i/4)*rowHeight)+"px; border: 1px solid #dfdfdf;'>"+
                                              "<div style='display:inline-block; width:10%; border-right: 1px solid #dfdfdf;' class='memoryTableNumbering'>"+i.toString(base)+"</div>"+
                                              "<div style='display:inline-block; width:44%; border-right: 1px solid #dfdfdf;' class='memoryTableValue'>"+simulator.MEM.read(i).toString()+"</div>"+
                                              "<div style='display:inline-block; width:44%;'>"+decoded+"</div>"+
                                            "</div>");
        }

        $("#"+div).html($("#"+div).html()+"<div style='height:"+rowHeight+"px; background-color:#f1f1f1; position:relative; top:"+((simulator.MEM._memory.length/4)*rowHeight)+"px; border-radius: 0px 0px 4px 4px;'>"+lastDivMessage+"</div>");
        
        var prevScrollPos = 0;
        $("#"+div).scroll(function(){

          //Normal scrolling
          if  (prevScrollPos > $("#"+div).scrollTop()) { //scrolled UP
            $("#"+div).children().each(function(){
              if (($(this).position().top>$("#"+div).height()) && ($(this).html()!=lastDivMessage)){
                //Find the lowest child and it's value
                var highest = simulator.MEM._memory.length*rowHeight; //highest possible position
                var highVal = (simulator.MEM._memory.length*rowHeight);
                base = getBase();
                $("#"+div).children().each(function(){
                  if (parseInt($(this).css("top").replace("px",""))<highest) {
                    highest = parseInt($(this).css("top").replace("px",""));
                    highVal = parseInt($(this).children().html(),base);
                  }
                });

                highVal = highVal - 4;
                if (highVal>=0) { 
                  base = getBase();
                  $(this).css({ top: ''+(highest-rowHeight)+'px' });
                  decoded = simulator.CPU._decode(simulator.MEM.read(highVal));
                  decoded = decoded ? instructionToString(decoded) : "";
                  if (decoded == "MOVE r0 r0") decoded="";

                  bgColor = (((highVal/4)%2)==0) ? "#ffffff" : "#f8f8f8";
                  $(this).css("background-color",''+bgColor );

                  $(this).html(""+"<div style='display:inline-block; width:10%; border-right: 1px solid #dfdfdf;' class='memoryTableNumbering'>"+highVal.toString(base)+"</div>"+
                                  "<div style='display:inline-block; width:44%; border-right: 1px solid #dfdfdf;'>"+simulator.MEM.read(highVal).toString()+"</div>"+
                                  "<div style='display:inline-block; width:44%;'>"+decoded+"</div>");
                }
              }
            });
          } else { //scrolled DOWN
            $("#"+div).children().each(function(){
              if (($(this).position().top<(-1*rowHeight)) && ($(this).html()!=lastDivMessage)){
                //Find the lowest child and it's value
                var highest = simulator.MEM._memory.length*rowHeight*-1; //highest possible position
                var highVal = 0;
                base = getBase();
                $("#"+div).children().each(function(){
                  if ((parseInt($(this).css("top").replace("px",""))>highest) && ($(this).html()!=lastDivMessage)) {
                    highest = parseInt($(this).css("top").replace("px",""));
                    highVal = parseInt($(this).children().html(),base);
                  }
                });
                highVal = highVal + 4;
                if (highVal<simulator.MEM._memory.length) { 
                  base = getBase();
                  $(this).css({ top: ''+(highest+rowHeight)+'px' });

                  decoded = simulator.CPU._decode(simulator.MEM.read(highVal));
                  decoded = decoded ? instructionToString(decoded) : "";
                  if (decoded == "MOVE r0 r0") decoded="";

                  bgColor = (((highVal/4)%2)==0) ? "#ffffff" : "#f8f8f8";
                  $(this).css("background-color",''+bgColor );

                  $(this).html(""+"<div style='display:inline-block; width:10%; border-right: 1px solid #dfdfdf;' class='memoryTableNumbering'>"+highVal.toString(base)+"</div>"+
                                  "<div style='display:inline-block; width:44%; border-right: 1px solid #dfdfdf;'>"+simulator.MEM.read(highVal).toString()+"</div>"+
                                  "<div style='display:inline-block; width:44%;'>"+decoded+"</div>");
                }
              }
            });
          };

          prevScrollPos = $("#"+div).scrollTop();

          //Check if the user scrolled too fast
          var invisibleCounter = 0;
          $("#"+div).children().each(function() { if ( (($(this).position().top>$("#"+div).height()) || ($(this).position().top<0)) && ($(this).html()!=lastDivMessage)) { invisibleCounter++; }; });
          if (invisibleCounter >= maxRows)  { //If all rows are invisible
            var i = Math.floor((prevScrollPos / rowHeight)) * 4;
            var x = i; //visual bug fix
            $("#"+div).children().each(function(){
              if (($(this).html()!=lastDivMessage) && (i<simulator.MEM._memory.length) && (i>=0)) {
                base = getBase();
                decoded = simulator.CPU._decode(simulator.MEM.read(i));
                decoded = decoded ? instructionToString(decoded) : "";
                if (decoded == "MOVE r0 r0") decoded="";

                bgColor = (((i/4)%2)==0) ? "#ffffff" : "#f8f8f8";

                $(this).css({ top: ''+((i/4)*rowHeight)+'px' });

                $(this).html( "<div style='display:inline-block; width:10%; border-right: 1px solid #dfdfdf;' class='memoryTableNumbering'>"+i.toString(base)+"</div>"+
                              "<div style='display:inline-block; width:44%; border-right: 1px solid #dfdfdf;'>"+simulator.MEM.read(i).toString()+"</div>"+
                              "<div style='display:inline-block; width:44%;'>"+decoded+"</div>");
                i += 4;
              } else if (($(this).html()!=lastDivMessage) && (i>=simulator.MEM._memory.length) && (i>=0) && (x>=0)) { //visual bug fix
                //fixes minor glitching when the user drags the scroller to the bottom of the memory view;
                base = getBase();
                decoded = simulator.CPU._decode(simulator.MEM.read(x));
                decoded = decoded ? instructionToString(decoded) : "";
                if (decoded == "MOVE r0 r0") decoded="";

                bgColor = (((x/4)%2)==0) ? "#ffffff" : "#f8f8f8";

                $(this).css({ top: ''+((x/4)*rowHeight)+'px' });

                $(this).html( "<div style='display:inline-block; width:10%; ' class='memoryTableNumbering'>"+x.toString(base)+"</div>"+
                              "<div style='display:inline-block; width:45%; '>"+simulator.MEM.read(x).toString()+"</div>"+
                              "<div style='display:inline-block; width:45%; '>"+decoded+"</div>");
                i += 4;
                x -= 4;
              };
            });
          };
        });
      }

      function changeState(st) {
        if (st === "stopped") {
          enableElements(["#frisc-load", "#frisc-freq", "#frisc-memsize"]);
          disableElements(["#frisc-execute", "#frisc-next", "#frisc-pause", "#frisc-stop"]);
          _state = st;
        } else if (st ==="loaded") {
          enableElements(["#frisc-execute", "#frisc-next", "#frisc-stop"]);
          disableElements(["#frisc-load", "#frisc-pause", "#frisc-freq", "#frisc-memsize"]);
          _state = st;
        } else if (st === "running") {
          enableElements(["#frisc-stop", "#frisc-pause", "#frisc-next"]);
          disableElements(["frisc-execute", "#frisc-load", "#frisc-freq", "#frisc-memsize"]);
          _state = st;
        }
      }

      function enableElements(elems) {
        for (var i=0; i<elems.length; i++) {
          $(elems[i]).attr('disabled', false);
        }
      }

      function disableElements(elems) {
        for (var i=0; i<elems.length; i++) {
          $(elems[i]).attr('disabled', true);
        }
      }

      function cpuStateToString() {
        var retVal = "";
        
        for (var key in simulator.CPU._r) {
          if (key !== 'sr') {
            retVal += key + ": " + simulator.CPU._r[key].toString() + " ";
          } else {
            retVal += key + ": " + simulator.CPU._r[key].toString() + " ( ";
            for (var flag in simulator.CPU._f) {
              retVal += flag + ": " + simulator.CPU._getFlag(simulator.CPU._f[flag]) + " ";
            }
            retVal += ") ";
          }
        }

        return retVal;
      }

      function instructionToString(instruction) {
        if (typeof instruction.args === 'undefined' || instruction.args === null) {
          return instruction.op;
        } else {
          return instruction.op + " " + instruction.args.join(" ");
        }
      }
      
      simulator.CPU.onBeforeRun = function() {
        simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-success'><b>Starting (or continuing) simulation!</b></span>");
      };
      
      simulator.CPU.onBeforeCycle = function() {
        simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-success'><b>New CPU cycle starting!</b></span>");
        simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-info'>CPU state:</span>" + " " + cpuStateToString(), "10px");
      };
      
      simulator.CPU.onAfterCycle = function() {
        simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-info'>CPU state:</span>" + " " + cpuStateToString(), "10px");
      };

      simulator.CPU.onBeforeExecute = function(instruction) {
        simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-info'>Executing FRISC instruction:</span>" + " " + instructionToString(instruction), "10px");
      };
      
      simulator.CPU.onStop = function() {
        simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-warning'><b>FRISC processor stopped!</b></span>");
        changeState("stopped");
      };

      $("#frisc-load").click(function() {
        if (_state === "stopped") {
          try {
            simulator.CPU.reset();
            var source = editor.getSession().getValue();
            if (source.length > 0 && source[source.length-1] !== '\n') {
              source += '\n';
            }
            var result = frisc_asm.parse(source);
          } catch (e) {
            simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-important'><b>Parsing error</b></span> on line " + e.line + " column " + e.column + " -- " + e.toString() + "");
            return;
          }

          try {
            simulator.CPU._frequency = parseInt($("#frisc-freq").val());
            simulator.MEM._size = parseInt($("#frisc-memsize").val()) * 1024;
            simulator.MEM.loadBinaryString(result.mem);
          } catch (e) {
            simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-important'><b>Loading error</b></span>" + " -- " + e.toString() + "");
            return
          }

          simulatorLog("<span style='padding: 2px 4px 1px'; class='label label-success'><b>Input program parsed successfully.</b></span>");
          changeState("loaded");

          //Show the memory list
          $("#frisc-inputdiv").hide("medium");
          $("#frisc-memorylist-hold").show("medium");
          createMemList("frisc-memorylist");
        }
      });

      $("#frisc-execute").click(function() {
        if (_state === "loaded") {
          simulator.CPU.run();
          changeState("running");
        }
      });

      $("#frisc-stop").click(function() {
        if (_state === "running" || _state === "loaded") {
          simulator.CPU.stop();
          changeState("stopped");
          //Hide the memory list
          $("#frisc-inputdiv").show("fast");
          $("#frisc-memorylist-hold").hide("fast");
          if ($("#frisc-memorylist-search").is(":visible")) $('#frisc-memorylist-searchtoggle').click();
          if ($("#frisc-memorylist-settings").is(":visible")) $('#frisc-memorylist-settingstoggle').click();
        }
      });

      $("#frisc-next").click(function() {
        if (_state === "running" || _state === "loaded") {
          simulator.CPU.performCycle();
        }
      });

      $("#frisc-pause").click(function() {
        if (_state === "running") {
          simulator.CPU.pause();
          changeState("loaded");
        }
      });

      $("#frisc-clear").click(function() {
        $("#cpuout").html("");
      });

      $("#frisc-freqset").click(function() {
        simulator.CPU._frequency = parseFloat($("#frisc-freq").val());
      });

      $("#frisc-mem-refresh").click(function() {
        var lower  = parseInt($("#frisc-mem-lower").val(), getBase());
        var higher = parseInt($("#frisc-mem-upper").val(), getBase());
        memLog(getMemState(lower, higher));
      });
      
      $("#frisc-showhidesettings").click(function() {
        if ($("#frisc-settings").is(":visible")) {
          $('#cpuout').animate({ height: height }, 603, function() {;} );
          $("#frisc-settings").hide("slow");
          
        } else {
          $('#cpuout').animate({ height: parseInt(height)-$("#frisc-settings").outerHeight(true) }, 603, function() {;} );
          $("#frisc-settings").show("slow");
        }
      });

      //memorylist search
      $("#skrMemLisSearch").click(function() {
        var searcher = parseInt($("#skrMemLisSearchField").val(), getBase())/4;
        $('#frisc-memorylist').animate({scrollTop: (18*searcher)}, 0 ,function() {;});
      });

      //memorylist numbering
      $("#skrBaseRadioDec").click(function() {
        if ($("#skrBaseRadioDec").attr('class')=="btn active") return;
        $(".memoryTableNumbering").each(function(){
          $(this).html(parseInt($(this).html(), 16).toString(10));
        });
      });
      $("#skrBaseRadioHex").click(function() {
        if ($("#skrBaseRadioHex").attr('class')=="btn active") return;
        $(".memoryTableNumbering").each(function(){
          $(this).html(parseInt($(this).html(), 10).toString(16));
        });
      });
    </script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-25513601-1']);
      _gaq.push(['_setDomainName', 'auto']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);
    
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
        'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
